<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙ„Ø§ØªÙŠ</title>
    <link rel="stylesheet" href="salaty.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ•Œ</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">       
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div class="header-controls">
                    <div class="theme-switcher" id="theme-switcher" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±">
                        <div class="theme-switcher-handle"></div>
                        <i class="fas fa-sun"></i>
                        <i class="fas fa-moon"></i>
                    </div>
                    <div class="lang-switcher" id="lang-switcher" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©">
                        <span data-translate-key="langToggle">EN</span>
                    </div>
                </div>
                <div style="flex-grow: 1;"></div>
                <h1><i class="fas fa-mosque"></i> <span data-translate-key="pageTitle">ØµÙ„Ø§ØªÙŠ</span></h1>
                <div style="flex-grow: 1;"></div>
                <div class="header-controls" style="visibility: hidden;"> <div class="theme-switcher"></div><div class="lang-switcher"></div></div>
            </div>
            <p class="subtitle" data-translate-key="subtitle">ØªØªØ¨Ø¹ ØµÙ„ÙˆØ§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ²Ø§Ù…Ùƒ</p>
            <div class="main-nav">
             <button id="nav-prayer" class="nav-tab active" data-translate-key="navPrayer">Ø§Ù„ØµÙ„Ø§Ø©</button>
<button id="nav-adhkar" class="nav-tab" data-translate-key="navAdhkar">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</button>
<button id="nav-tasbeeh" class="nav-tab" data-translate-key="navTasbeeh">Ø§Ù„Ø³Ø¨Ø­Ø©</button>
<a href="Taktem.html" target="_blank" rel="noopener noreferrer"
   id="nav-quran" class="nav-tab" data-translate-key="navQuranKhatm">
   Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†
</a>

<a href="azkar_ramadan.html" target="_blank" rel="noopener noreferrer"
   id="nav-ramadan-duas" class="nav-tab" data-translate-key="navRamadanDuas">
   Ø£Ø¯Ø¹ÙŠØ© Ø±Ù…Ø¶Ø§Ù†
</a>

<a href="traweh.html" target="_blank" rel="noopener noreferrer"
   id="nav-taraweeh" class="nav-tab" data-translate-key="navTaraweehDua">
   Ø£Ø¯Ø¹ÙŠØ© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­
</a>

<a href="sadakate.html" target="_blank" rel="noopener noreferrer"
   id="nav-sadaqat" class="nav-tab" data-translate-key="navSadaqat">
   ØµØ¯Ù‚Ø§ØªÙŠ
</a>

<a href="lessons.html" target="_blank" rel="noopener noreferrer"
   id="nav-lessons" class="nav-tab" data-translate-key="navLessons">
   Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©
</a>
<a href="about.html" class="nav-tab" data-translate-key="aboutSite">
    Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹
</a>


            </div>
        </header>

        <main id="prayer-tracker-view">
            <div class="week-selector">
                <div class="week-nav">
                    <button class="nav-btn" id="prev-week" title="Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚"><i class="fas fa-chevron-right"></i></button>
                    <button class="nav-btn" id="next-week" title="Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„ØªØ§Ù„ÙŠ"><i class="fas fa-chevron-left"></i></button>
                </div>
                <div class="week-title" id="week-title"></div>
                <button class="today-btn" id="today-btn"><i class="fas fa-calendar-day"></i> <span data-translate-key="todayBtn">Ø§Ù„ÙŠÙˆÙ…</span></button>
            </div>

            <div class="week-container" id="week-container"></div>

            <div class="stats">
                <h2><i class="fas fa-chart-line"></i> <span data-translate-key="statsTitle">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span></h2>
                
                <div class="progress-section">
                    <div class="title" data-translate-key="onTimeRatio">Ù†Ø³Ø¨Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§</div>
                    <div class="progress-wrapper">
                        <div class="progress-bar">
                            <div class="progress" id="on-time-progress-bar" style="background: var(--primary-color);"></div>
                        </div>
                        <div class="progress-percentage progress-percentage-on-time" id="on-time-percentage">0%</div>
                    </div>
                </div>

                <div class="progress-section">
                    <div class="title" data-translate-key="lateRatio">Ù†Ø³Ø¨Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª Ù‚Ø¶Ø§Ø¡</div>
                    <div class="progress-wrapper">
                        <div class="progress-bar">
                            <div class="progress" id="late-progress-bar" style="background: var(--accent-color);"></div>
                        </div>
                        <div class="progress-percentage progress-percentage-late" id="late-percentage">0%</div>
                    </div>
                </div>

                <div class="stats-content">
                    <div class="stat-item">
                        <div class="stat-value" id="completed-days-value">0</div>
                        <div class="stat-label" data-translate-key="completedDays">Ø£ÙŠØ§Ù… Ù…ÙƒØªÙ…Ù„Ø©</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="on-time-prayers-value">0</div>
                        <div class="stat-label" data-translate-key="onTimePrayers">ØµÙ„ÙˆØ§Øª ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="late-prayers-value">0</div>
                        <div class="stat-label" data-translate-key="latePrayers">ØµÙ„ÙˆØ§Øª Ù‚Ø¶Ø§Ø¡</div>
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-primary" id="reset-btn"><i class="fas fa-redo"></i> <span data-translate-key="resetWeekBtn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span></button>
                    <button class="btn btn-secondary" id="mark-all-btn"><i class="fas fa-check-double"></i> <span data-translate-key="completePastBtn">Ø¥ÙƒÙ…Ø§Ù„ ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø§Ø¶ÙŠØ©</span></button>
                </div>
            </div>

            <div class="historical-stats" id="historical-stats">
                <h2><i class="fas fa-calendar-check"></i> <span data-translate-key="historyTitle">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</span></h2>
                <div id="historical-weeks-container">
                       <p id="no-history-msg" style="color: var(--light-text); text-align: center;" data-translate-key="noHistory">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø¹Ø¯.</p>
                </div>
            </div>
        </main>

        <main id="tasbeeh-view" style="display: none;">
            <div class="tasbeeh-container">
                <div class="dhikr-selector-card">
                    <h2 data-translate-key="tasbeehSelectDhikr">Ø§Ø®ØªØ± Ø§Ù„Ø°ÙƒØ±</h2>
                    <select id="dhikr-select"></select>
                    <input type="text" id="custom-dhikr-input" data-translate-key="customDhikrPlaceholder" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø°ÙƒØ± Ù‡Ù†Ø§..." style="display: none; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto;" />
                </div>
    
                <div class="tasbeeh-counter-area" id="tasbeeh-btn">
                    <div id="tasbeeh-counter-display">0</div>
                    <div id="current-dhikr-display"></div>
                    <button id="tasbeeh-reset-btn" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ"><i class="fas fa-redo"></i></button>
                </div>
    
                <div class="stats">
                    <h2><i class="fas fa-layer-group"></i> <span data-translate-key="tasbeehTotalCounts">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø¨ÙŠØ­Ø§Øª</span></h2>
                    <div id="tasbeeh-stats-container" class="stats-content"></div>
                    <div class="actions">
                        <button class="btn btn-secondary" id="reset-all-tasbeeh-btn"><i class="fas fa-trash-alt"></i> <span data-translate-key="resetAllTasbeehBtn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span></button>
                    </div>
                </div>
            </div>
        </main>

        <main id="adhkar-view" style="display: none;">
            <div class="stats adhkar-selector">
                <h2 data-translate-key="adhkarTitle"><i class="fas fa-book-open"></i> Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡</h2>
                <div class="actions">
                    <button class="btn btn-primary" id="select-sabah-btn"><i class="fas fa-sun"></i> <span data-translate-key="adhkarSabah">Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­</span></button>
                    <button class="btn btn-primary" id="select-masaa-btn" style="background: var(--primary-dark);"><i class="fas fa-moon"></i> <span data-translate-key="adhkarMasaa">Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡</span></button>
                </div>
            </div>
            
            <div id="adhkar-list-container" class="tasbeeh-container" style="display: none;">
                <div class="stats">
                    <h2 id="current-adhkar-title"></h2>
                    <div id="adhkar-items-wrapper"></div>
                    <div class="actions">
                         <button class="btn btn-secondary" id="complete-all-adhkar-btn"><i class="fas fa-check-double"></i> <span data-translate-key="completeAllAdhkar">Ø¥ØªÙ…Ø§Ù… ÙƒÙ„ Ø§Ù„Ø£Ø°ÙƒØ§Ø±</span></button>
                    </div>
                </div>
            </div>

            <div id="adhkar-weekly-tracker">
                 <div class="week-selector">
                    <div class="week-nav">
                        <button class="nav-btn" id="adhkar-prev-week" title="Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚"><i class="fas fa-chevron-right"></i></button>
                        <button class="nav-btn" id="adhkar-next-week" title="Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„ØªØ§Ù„ÙŠ"><i class="fas fa-chevron-left"></i></button>
                    </div>
                    <div class="week-title" id="adhkar-week-title"></div>
<button class="today-btn" id="today-btn">
    <i class="fas fa-calendar-day"></i> 
    <span data-translate-key="todayBtn">Ø§Ù„ÙŠÙˆÙ…</span>
</button>

<input type="date" id="date-picker" style="display:none;">
                </div>

                <div class="week-container" id="adhkar-week-container"></div>

                <div class="stats">
                    <h2><i class="fas fa-chart-line"></i> <span data-translate-key="statsAdhkarTitle">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span></h2>

                    <div class="progress-section">
                        <div class="title" data-translate-key="sabahCompletedRatio">Ù†Ø³Ø¨Ø© Ø¥ØªÙ…Ø§Ù… Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­</div>
                        <div class="progress-wrapper">
                            <div class="progress-bar">
                                <div class="progress" id="sabah-progress-bar" style="background: var(--primary-color);"></div>
                            </div>
                            <div class="progress-percentage progress-percentage-on-time" id="sabah-percentage">0%</div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="title" data-translate-key="masaaCompletedRatio">Ù†Ø³Ø¨Ø© Ø¥ØªÙ…Ø§Ù… Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡</div>
                        <div class="progress-wrapper">
                            <div class="progress-bar">
                                <div class="progress" id="masaa-progress-bar" style="background: var(--accent-color);"></div>
                            </div>
                            <div class="progress-percentage progress-percentage-late" id="masaa-percentage">0%</div>
                        </div>
                    </div>

                    <div class="stats-content">
                        <div class="stat-item">
                            <div class="stat-value" id="adhkar-sabah-value">0</div>
                            <div class="stat-label" data-translate-key="sabahCompleted">ØµØ¨Ø§Ø­ Ù…ÙƒØªÙ…Ù„</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="adhkar-masaa-value">0</div>
                            <div class="stat-label" data-translate-key="masaaCompleted">Ù…Ø³Ø§Ø¡ Ù…ÙƒØªÙ…Ù„</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="adhkar-sabah-missed-value" style="color: var(--secondary-color);">0</div>
                            <div class="stat-label" data-translate-key="sabahMissed">ØµØ¨Ø§Ø­ ÙØ§Ø¦Øª</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="adhkar-masaa-missed-value" style="color: var(--secondary-color);">0</div>
                            <div class="stat-label" data-translate-key="masaaMissed">Ù…Ø³Ø§Ø¡ ÙØ§Ø¦Øª</div>
                        </div>
                    </div>
                     <div class="actions">
                        <button class="btn btn-primary" id="adhkar-reset-btn"><i class="fas fa-redo"></i> <span data-translate-key="resetWeekBtn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span></button>
                        <button class="btn btn-secondary" id="adhkar-mark-all-btn"><i class="fas fa-check-double"></i> <span data-translate-key="completePastBtn">Ø¥ÙƒÙ…Ø§Ù„ ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø§Ø¶ÙŠØ©</span></button>
                    </div>
                </div>
                
                <div class="historical-stats" id="historical-adhkar-stats">
                    <h2><i class="fas fa-calendar-check"></i> <span data-translate-key="historyTitle">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</span></h2>
                    <div id="historical-adhkar-container">
                           <p style="color: var(--light-text); text-align: center;" data-translate-key="noHistory">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø¹Ø¯.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div class="notification" id="notification"></div>

    <div class="modal-overlay" id="on-time-modal">
        <div class="modal-content">
            <h2 data-translate-key="recordPrayerTitle"><i class="fas fa-clock"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø©</h2>
            <p data-translate-key="recordPrayerMsg">Ù‡Ù„ Ø£Ø¯ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§ Ø§Ù„Ù…Ø­Ø¯Ø¯ØŸ</p>
            <div class="modal-actions">
                <button class="btn btn-primary" id="confirm-on-time"><i class="fas fa-check"></i> <span data-translate-key="onTimeConfirm">Ù†Ø¹Ù…ØŒ ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§</span></button>
                <button class="btn" id="confirm-late" style="background-color: var(--accent-color); color: white;"><i class="fas fa-hourglass-half"></i> <span data-translate-key="lateConfirm">Ù„Ø§ØŒ Ù‚Ø¶Ø§Ø¡</span></button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="confirmation-modal">
        <div class="modal-content">
            <h2 id="confirmation-title" data-translate-key="confirmActionTitle"><i class="fas fa-exclamation-triangle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</h2>
            <p id="confirmation-message">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ</p>
            <div class="modal-actions">
                <button class="btn btn-primary" id="confirm-yes"><i class="fas fa-check"></i> <span data-translate-key="yesBtn">Ù†Ø¹Ù…</span></button>
                <button class="btn btn-secondary" id="confirm-no"><i class="fas fa-times"></i> <span data-translate-key="cancelBtn">Ø¥Ù„ØºØ§Ø¡</span></button>
            </div>
        </div>
    </div>

    <button id="back-to-top-btn" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰"><i class="fas fa-arrow-up"></i></button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Global Elements ---
            const themeSwitcher = document.getElementById('theme-switcher');
            const langSwitcher = document.getElementById('lang-switcher');
            const notification = document.getElementById('notification');
            const backToTopBtn = document.getElementById('back-to-top-btn');
            
            // --- Navigation Elements ---
            const navPrayerBtn = document.getElementById('nav-prayer');
            const navTasbeehBtn = document.getElementById('nav-tasbeeh');
            const navAdhkarBtn = document.getElementById('nav-adhkar');
            const prayerTrackerView = document.getElementById('prayer-tracker-view');
            const tasbeehView = document.getElementById('tasbeeh-view');
            const adhkarView = document.getElementById('adhkar-view');

            // --- Prayer Tracker Elements ---
            const weekContainer = document.getElementById('week-container');
            const weekTitle = document.getElementById('week-title');
            const prevWeekBtn = document.getElementById('prev-week');
            const nextWeekBtn = document.getElementById('next-week');
            const todayBtn = document.getElementById('today-btn');
            const completedDaysEl = document.getElementById('completed-days-value');
            const onTimePrayersEl = document.getElementById('on-time-prayers-value');
            const latePrayersEl = document.getElementById('late-prayers-value');
            const onTimeProgressBar = document.getElementById('on-time-progress-bar');
            const onTimePercentageEl = document.getElementById('on-time-percentage');
            const lateProgressBar = document.getElementById('late-progress-bar');
            const latePercentageEl = document.getElementById('late-percentage');
            const resetBtn = document.getElementById('reset-btn');
            const markAllBtn = document.getElementById('mark-all-btn');
            const historicalContainer = document.getElementById('historical-weeks-container');
            const onTimeModal = document.getElementById('on-time-modal');
            const confirmOnTimeBtn = document.getElementById('confirm-on-time');
            const confirmLateBtn = document.getElementById('confirm-late');
            
            // --- Confirmation Modal Elements ---
            const confirmationModal = document.getElementById('confirmation-modal');
            const confirmYesBtn = document.getElementById('confirm-yes');
            const confirmNoBtn = document.getElementById('confirm-no');
            const confirmationMessage = document.getElementById('confirmation-message');

            // --- Tasbeeh Elements ---
            const dhikrSelect = document.getElementById('dhikr-select');
            const customDhikrInput = document.getElementById('custom-dhikr-input');
            const tasbeehBtn = document.getElementById('tasbeeh-btn');
            const tasbeehCounterDisplay = document.getElementById('tasbeeh-counter-display');
            const currentDhikrDisplay = document.getElementById('current-dhikr-display');
            const tasbeehResetBtn = document.getElementById('tasbeeh-reset-btn');
            const tasbeehStatsContainer = document.getElementById('tasbeeh-stats-container');
            const resetAllTasbeehBtn = document.getElementById('reset-all-tasbeeh-btn');
            
            // --- Adhkar Elements ---
            const selectSabahBtn = document.getElementById('select-sabah-btn');
            const selectMasaaBtn = document.getElementById('select-masaa-btn');
            const adhkarListContainer = document.getElementById('adhkar-list-container');
            const currentAdhkarTitle = document.getElementById('current-adhkar-title');
            const adhkarItemsWrapper = document.getElementById('adhkar-items-wrapper');
            const completeAllAdhkarBtn = document.getElementById('complete-all-adhkar-btn');
            const adhkarWeekContainer = document.getElementById('adhkar-week-container');
            const adhkarWeekTitle = document.getElementById('adhkar-week-title');
            const adhkarPrevWeekBtn = document.getElementById('adhkar-prev-week');
            const adhkarNextWeekBtn = document.getElementById('adhkar-next-week');
const adhkarTodayBtn = document.getElementById('today-btn');
            const adhkarSabahValueEl = document.getElementById('adhkar-sabah-value');
            const adhkarMasaaValueEl = document.getElementById('adhkar-masaa-value');
            const adhkarResetBtn = document.getElementById('adhkar-reset-btn');
            const adhkarMarkAllBtn = document.getElementById('adhkar-mark-all-btn');
            const sabahProgressBar = document.getElementById('sabah-progress-bar');
            const sabahPercentageEl = document.getElementById('sabah-percentage');
            const masaaProgressBar = document.getElementById('masaa-progress-bar');
            const masaaPercentageEl = document.getElementById('masaa-percentage');
            const adhkarSabahMissedValueEl = document.getElementById('adhkar-sabah-missed-value');
            const adhkarMasaaMissedValueEl = document.getElementById('adhkar-masaa-missed-value');
            const historicalAdhkarContainer = document.getElementById('historical-adhkar-container');

            // --- Constants, State, and Translations ---
            const translations = {
                pageTitle: { ar: "ØµÙ„Ø§ØªÙŠ", en: "My Salah" },
                subtitle: { ar: "ØªØªØ¨Ø¹ ØµÙ„ÙˆØ§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ²Ø§Ù…Ùƒ", en: "Track your daily prayers and stay committed" },
                navPrayer: { ar: "Ø§Ù„ØµÙ„Ø§Ø©", en: "Prayer" },
                navTasbeeh: { ar: "Ø§Ù„Ø³Ø¨Ø­Ø©", en: "Tasbeeh" },
             navQuranKhatm: { ar: "Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†", en: "Quran Khatm" },
navRamadanDuas: { ar: "Ø£Ø¯Ø¹ÙŠØ© Ø±Ù…Ø¶Ø§Ù†", en: "Ramadan Duas" },
navTaraweehDua: { ar: " Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­", en: "Taraweeh " },
navSadaqat: { ar: "ØµØ¯Ù‚Ø§ØªÙŠ", en: "My Charity" },
navLessons: { ar: "Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©", en: "Islamic Lessons" },
aboutSite: { ar: "Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹", en: "About the Website" },
                todayBtn: { ar: "Ø§Ù„ÙŠÙˆÙ…", en: "Today" },
                statsTitle: { ar: "Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹", en: "This Week's Stats" },
                onTimeRatio: { ar: "Ù†Ø³Ø¨Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§", en: "On-Time Prayers Ratio" },
                lateRatio: { ar: "Ù†Ø³Ø¨Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª Ù‚Ø¶Ø§Ø¡", en: "Late Prayers Ratio" },
                completedDays: { ar: "Ø£ÙŠØ§Ù… Ù…ÙƒØªÙ…Ù„Ø©", en: "Completed Days" },
                onTimePrayers: { ar: "ØµÙ„ÙˆØ§Øª ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§", en: "On-Time Prayers" },
                latePrayers: { ar: "ØµÙ„ÙˆØ§Øª Ù‚Ø¶Ø§Ø¡", en: "Late Prayers" },
                resetWeekBtn: { ar: "Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹", en: "Reset Week" },
                completePastBtn: { ar: "Ø¥ÙƒÙ…Ø§Ù„ ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø§Ø¶ÙŠØ©", en: "Complete All Past Days" },
                historyTitle: { ar: "Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹", en: "Weekly History" },
                noHistory: { ar: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø¹Ø¯.", en: "No history data to display yet." },
                recordPrayerTitle: { ar: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø©", en: "Record Prayer" },
                recordPrayerMsg: { ar: "Ù‡Ù„ Ø£Ø¯ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§ Ø§Ù„Ù…Ø­Ø¯Ø¯ØŸ", en: "Did you perform the prayer on time?" },
                onTimeConfirm: { ar: "Ù†Ø¹Ù…ØŒ ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§", en: "Yes, On Time" },
                lateConfirm: { ar: "Ù„Ø§ØŒ Ù‚Ø¶Ø§Ø¡", en: "No, Late" },
                confirmActionTitle: { ar: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡", en: "Confirm Action" },
                yesBtn: { ar: "Ù†Ø¹Ù…", en: "Yes" },
                cancelBtn: { ar: "Ø¥Ù„ØºØ§Ø¡", en: "Cancel" },
                langToggle: { ar: "EN", en: "Ø¹" },
                notification_prayerRecorded: { ar: "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø© ÙƒÙ€'{status}' Ø¨Ù†Ø¬Ø§Ø­.", en: "Prayer successfully recorded as '{status}'." },
                notification_prayerCanceled: { ar: "ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø©.", en: "Prayer record canceled." },
                notification_weekReset: { ar: "ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹.", en: "Weekly data has been reset." },
                notification_pastCompleted: { ar: "ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„ÙØ§Ø¦ØªØ© (ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§).", en: "Missed prayers have been marked as completed (on-time)." },
                status_on_time: { ar: "ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§", en: "On-time" },
                status_late: { ar: "Ù‚Ø¶Ø§Ø¡", en: "Late" },
                week_current: { ar: "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ", en: "Current Week" },
                week_next: { ar: "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…", en: "Next Week" },
                week_after: { ar: "Ø¨Ø¹Ø¯ {count} Ø£Ø³Ø§Ø¨ÙŠØ¹", en: "{count} Weeks Later" },
                week_ago: { ar: "Ù‚Ø¨Ù„ {count} Ø£Ø³Ø§Ø¨ÙŠØ¹", en: "{count} Weeks Ago" },
                week_title_prefix: { ar: "Ø£Ø³Ø¨ÙˆØ¹", en: "Week of" },
                tasbeehSelectDhikr: { ar: "Ø§Ø®ØªØ± Ø§Ù„Ø°ÙƒØ±", en: "Select Dhikr" },
                customDhikrPlaceholder: { ar: "Ø§ÙƒØªØ¨ Ø§Ù„Ø°ÙƒØ± Ù‡Ù†Ø§...", en: "Type custom dhikr here..." },
                tasbeehTotalCounts: { ar: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø¨ÙŠØ­Ø§Øª", en: "Total Counts" },
                tasbeehCountReset: { ar: "ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯.", en: "Counter has been reset." },
                resetAllTasbeehBtn: { ar: "Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ", en: "Reset All Totals" },
                confirmResetAllTasbeehMsg: { ar: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ³Ø¨ÙŠØ­ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§.", en: "Are you sure you want to delete all tasbeeh stats? This cannot be undone." },
                notification_tasbeehResetAll: { ar: "ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ³Ø¨ÙŠØ­.", en: "All tasbeeh statistics have been cleared." },
                deleteDhikrTitle: { ar: "Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø°ÙƒØ±", en: "Delete this Dhikr" },
                notification_dhikrDeleted: { ar: "ØªÙ… Ø­Ø°Ù Ø§Ù„Ø°ÙƒØ± Ø¨Ù†Ø¬Ø§Ø­.", en: "Dhikr has been deleted." },
                confirmDeleteDhikrMsg: { ar: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø°ÙƒØ± '{dhikr}'ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙ‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.", en: "Are you sure you want to delete the dhikr '{dhikr}'? Its stats will be permanently removed." },
                navAdhkar: { ar: "Ø§Ù„Ø£Ø°ÙƒØ§Ø±", en: "Adhkar" },
                adhkarTitle: { ar: "Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡", en: "Morning & Evening Adhkar" },
                adhkarSabah: { ar: "Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­", en: "Morning Adhkar" },
                adhkarMasaa: { ar: "Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡", en: "Evening Adhkar" },
                completeAllAdhkar: { ar: "Ø¥ØªÙ…Ø§Ù… ÙƒÙ„ Ø§Ù„Ø£Ø°ÙƒØ§Ø±", en: "Complete All Adhkar" },
                statsAdhkarTitle: { ar: "Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹", en: "This Week's Adhkar Stats" },
                sabahCompleted: { ar: "ØµØ¨Ø§Ø­ Ù…ÙƒØªÙ…Ù„", en: "Morning Completed" },
                masaaCompleted: { ar: "Ù…Ø³Ø§Ø¡ Ù…ÙƒØªÙ…Ù„", en: "Evening Completed" },
                adhkarMarkedSabah: { ar: "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­.", en: "Morning Adhkar recorded." },
                adhkarMarkedMasaa: { ar: "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡.", en: "Evening Adhkar recorded." },
                adhkarUnmarkedSabah: { ar: "ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­.", en: "Morning Adhkar un-recorded." },
                adhkarUnmarkedMasaa: { ar: "ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡.", en: "Evening Adhkar un-recorded." },
                adhkarPastCompleted: { ar: "ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø§Ø¶ÙŠØ©.", en: "All past days' Adhkar have been completed." },
                adhkarWeekReset: { ar: "ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹.", en: "Adhkar weekly data has been reset." },
                dhikrCount: { ar: "Ø§Ù„ØªÙƒØ±Ø§Ø±", en: "Count" },
                sabahMissed: { ar: "ØµØ¨Ø§Ø­ ÙØ§Ø¦Øª", en: "Morning Missed" },
                masaaMissed: { ar: "Ù…Ø³Ø§Ø¡ ÙØ§Ø¦Øª", en: "Evening Missed" },
                sabahCompletedRatio: { ar: "Ù†Ø³Ø¨Ø© Ø¥ØªÙ…Ø§Ù… Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­", en: "Morning Adhkar Completion Ratio" },
                masaaCompletedRatio: { ar: "Ù†Ø³Ø¨Ø© Ø¥ØªÙ…Ø§Ù… Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡", en: "Evening Adhkar Completion Ratio" }
            };

         const daysOfWeek = {
Â  Â  Â  Â  Â  Â  Â  Â  ar: ['Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡'],
Â  Â  Â  Â  Â  Â  Â  Â  en: ['Thursday', 'Friday', 'Saturday', 'Sunday', 'Monday', 'Tuesday', 'Wednesday']
Â  Â  Â  Â  Â  Â  };
            const prayers = {
                ar: { fajr: 'Ø§Ù„ÙØ¬Ø±', dhuhr: 'Ø§Ù„Ø¸Ù‡Ø±', asr: 'Ø§Ù„Ø¹ØµØ±', maghrib: 'Ø§Ù„Ù…ØºØ±Ø¨', isha: 'Ø§Ù„Ø¹Ø´Ø§Ø¡', jumua: 'Ø§Ù„Ø¬Ù…Ø¹Ø©' },
                en: { fajr: 'Fajr', dhuhr: 'Dhuhr', asr: 'Asr', maghrib: 'Maghrib', isha: 'Isha', jumua: 'Jumua' }
            };
            const prayerKeys = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];

            const adhkarContent = {
                sabah: [
                    { text: 'Ø£Ø¹ÙˆØ° Ø¨Ø§Ù„Ù„Ù‡ Ù…Ù† Ø§Ù„Ø´ÙŠØ·Ø§Ù† Ø§Ù„Ø±Ø¬ÙŠÙ… "Ø§Ù„Ù„Ù‘Ù‡Ù Ù„Ø§Ù Ø¥ÙÙ„ÙÙ€Ù‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù ..."', count: 1, current: 0 },
                    { text: 'Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ… "Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ­ÙØ¯ÙŒ..." (3 Ù…Ø±Ø§Øª)', count: 3, current: 0 },
                    { text: 'Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ… "Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ø§Ù„Ù’ÙÙÙ„ÙÙ‚Ù..." (3 Ù…Ø±Ø§Øª)', count: 3, current: 0 },
                    { text: 'Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ… "Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù..." (3 Ù…Ø±Ø§Øª)', count: 3, current: 0 },
                    { text: 'Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ ÙˆÙØ£ÙØµÙ’Ø¨ÙØ­Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ Ù„Ø§Ù Ø¥ÙÙ„ÙÙ‡Ù Ø¥Ù„Ø§ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„Ø§Ù Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡Ù...', count: 1, current: 0 },
                    { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙÙƒÙ Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙØ­Ù’ÙŠÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙÙ…ÙÙˆØªÙ ÙˆÙØ¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù†ÙÙ‘Ø´ÙÙˆØ±Ù', count: 1, current: 0 },
                    { text: 'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡ÙØŒ Ø¹ÙØ¯ÙØ¯Ù Ø®ÙÙ„Ù’Ù‚ÙÙ‡ÙØŒ ÙˆÙØ±ÙØ¶ÙØ§ Ù†ÙÙÙ’Ø³ÙÙ‡ÙØŒ ÙˆÙØ²ÙÙ†ÙØ©Ù Ø¹ÙØ±Ù’Ø´ÙÙ‡ÙØŒ ÙˆÙÙ…ÙØ¯ÙØ§Ø¯Ù ÙƒÙÙ„ÙÙ…ÙØ§ØªÙÙ‡Ù', count: 3, current: 0 },
                    { text: 'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡Ù', count: 100, current: 0 }
                ],
                masaa: [
                    { text: 'Ø£Ø¹ÙˆØ° Ø¨Ø§Ù„Ù„Ù‡ Ù…Ù† Ø§Ù„Ø´ÙŠØ·Ø§Ù† Ø§Ù„Ø±Ø¬ÙŠÙ… "Ø§Ù„Ù„Ù‘Ù‡Ù Ù„Ø§Ù Ø¥ÙÙ„ÙÙ€Ù‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù ..."', count: 1, current: 0 },
                    { text: 'Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ… "Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ­ÙØ¯ÙŒ..." (3 Ù…Ø±Ø§Øª)', count: 3, current: 0 },
                    { text: 'Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ… "Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ø§Ù„Ù’ÙÙÙ„ÙÙ‚Ù..." (3 Ù…Ø±Ø§Øª)', count: 3, current: 0 },
                    { text: 'Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ… "Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù..." (3 Ù…Ø±Ø§Øª)', count: 3, current: 0 },
                    { text: 'Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ ÙˆÙØ£ÙÙ…Ù’Ø³ÙÙ‰ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ Ù„Ø§Ù Ø¥ÙÙ„ÙÙ‡Ù Ø¥Ù„Ø§ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„Ø§Ù Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡Ù...', count: 1, current: 0 },
                    { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙÙƒÙ Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙØ­Ù’ÙŠÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙÙ…ÙÙˆØªÙØŒ ÙˆÙØ¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù’Ù…ÙØµÙÙŠØ±Ù', count: 1, current: 0 },
                    { text: 'Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙÙ„ÙÙ…ÙØ§ØªÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„ØªÙÙ‘Ø§Ù…ÙÙ‘Ø§ØªÙ Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ Ø®ÙÙ„ÙÙ‚Ù', count: 3, current: 0 }
                ]
            };

            const tasbeehOptions = {
                subhanallah: { ar: 'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡', en: 'Subhanallah' },
                alhamdulillah: { ar: 'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡', en: 'Alhamdulillah' },
                la_ilaha_illallah: { ar: 'Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡', en: 'La ilaha illallah' },
                allahu_akbar: { ar: 'Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±', en: 'Allahu Akbar' },
                astaghfirullah: { ar: 'Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡', en: 'Astaghfirullah' },
                salawat: { ar: 'Ø§Ù„Ù„Ù‡Ù… ØµÙ„ Ø¹Ù„Ù‰ Ù†Ø¨ÙŠÙ†Ø§ Ù…Ø­Ù…Ø¯', en: 'Allahumma salli ala nabiyina Muhammad' },
                custom: { ar: 'Ø°ÙƒØ± Ù…Ø®ØµØµ', en: 'Custom Dhikr' }
            };
            
const now = new Date();
const anchorDate = new Date(
    now.getFullYear(),
    now.getMonth(),
    now.getDate()
);


            let prayerData = JSON.parse(localStorage.getItem('prayerData')) || {};
            let tasbeehData = JSON.parse(localStorage.getItem('tasbeehData')) || {};
            let adhkarProgress = JSON.parse(localStorage.getItem('adhkarProgress')) || {};
            let currentAdhkarType = null; // 'sabah' or 'masaa'
            let currentAdhkarWeekOffset = 0;
            let currentWeekOffset = 0;
            let currentTasbeehCount = 0;
            let onConfirmAction = null;
            let prayerToUpdate = null;
            let currentLang = localStorage.getItem('language') || 'ar';

            function initApp() {
                setupTheme();
                setLanguage(currentLang, true);
                addEventListeners();
                
                goToToday();
                renderHistoricalStats();

                initTasbeeh();
                
                initAdhkar();
            }
            
            function addEventListeners() {
                // Global
                themeSwitcher.addEventListener('click', toggleTheme);
                langSwitcher.addEventListener('click', toggleLanguage);
                window.addEventListener('scroll', handleScroll);
                backToTopBtn.addEventListener('click', scrollToTop);
                
                // Navigation
                navPrayerBtn.addEventListener('click', () => switchView('prayer'));
                navTasbeehBtn.addEventListener('click', () => switchView('tasbeeh'));
                navAdhkarBtn.addEventListener('click', () => switchView('adhkar'));

                // Prayer Tracker
                prevWeekBtn.addEventListener('click', () => changeWeek(-1));
                nextWeekBtn.addEventListener('click', () => changeWeek(1));
const datePicker = document.getElementById('date-picker');

todayBtn.addEventListener('click', () => {
    // ÙŠÙØªØ­ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø­Ø³Ø¨ ØªÙˆÙ‚ÙŠØª Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const today = new Date();
    const isoDate = today.toISOString().split('T')[0];
    datePicker.value = isoDate;
    datePicker.showPicker(); // ÙŠÙØªØ­ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù…Ø¨Ø§Ø´Ø±Ø©
});
datePicker.addEventListener('change', (e) => {
    const selectedDate = new Date(e.target.value);

    // Ù†Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØªØ§Ø± ÙˆØ§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
    const today = new Date(anchorDate);
    
    const diffTime = selectedDate - today;
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

    // Ù†Ø­ÙˆÙ„ Ø§Ù„ÙØ±Ù‚ Ø¥Ù„Ù‰ Ø£Ø³Ø§Ø¨ÙŠØ¹
    currentWeekOffset = Math.floor(diffDays / 7);

    renderWeek();
});
                confirmYesBtn.addEventListener('click', handleConfirmYes);
                confirmNoBtn.addEventListener('click', () => confirmationModal.classList.remove('active'));
                confirmOnTimeBtn.addEventListener('click', () => handlePrayerRecording('on_time'));
                confirmLateBtn.addEventListener('click', () => handlePrayerRecording('late'));
                onTimeModal.addEventListener('click', (e) => { if (e.target === onTimeModal) onTimeModal.classList.remove('active'); });
                resetBtn.addEventListener('click', () => showConfirmation(translations.resetWeekBtn[currentLang], resetWeekLogic));
                markAllBtn.addEventListener('click', () => showConfirmation(translations.completePastBtn[currentLang], markAllPastAsCompletedLogic));
                
                // Adhkar Listeners
                selectSabahBtn.addEventListener('click', () => showAdhkarList('sabah'));
                selectMasaaBtn.addEventListener('click', () => showAdhkarList('masaa'));
                adhkarItemsWrapper.addEventListener('click', handleDhikrItemClick);
                completeAllAdhkarBtn.addEventListener('click', handleCompleteAllAdhkar);
                adhkarPrevWeekBtn.addEventListener('click', () => changeAdhkarWeek(-1));
                adhkarNextWeekBtn.addEventListener('click', () => changeAdhkarWeek(1));
if (adhkarTodayBtn) {
    adhkarTodayBtn.addEventListener('click', goToAdhkarToday);
}
                adhkarResetBtn.addEventListener('click', () => showConfirmation(translations.adhkarWeekReset[currentLang], resetAdhkarWeekLogic));
                adhkarMarkAllBtn.addEventListener('click', () => showConfirmation(translations.adhkarPastCompleted[currentLang], markAllPastAdhkarAsCompletedLogic));
                adhkarWeekContainer.addEventListener('click', handleAdhkarDayClick);

                // Tasbeeh
                dhikrSelect.addEventListener('change', handleDhikrChange);
if (tasbeehBtn) {
    tasbeehBtn.addEventListener('click', (e) => {
        // Ù…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø±ÙŠØ³Øª Ù…Ù† Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
        if (e.target.closest('#tasbeeh-reset-btn')) return;
        handleTasbeehClick();
    });
}
                tasbeehResetBtn.addEventListener('click', handleTasbeehReset);
                resetAllTasbeehBtn.addEventListener('click', () => showConfirmation(translations.confirmResetAllTasbeehMsg[currentLang], resetAllTasbeehLogic));
                tasbeehStatsContainer.addEventListener('click', handleDeleteSingleDhikr);
            }

            function switchView(viewName) {
                prayerTrackerView.style.display = 'none';
                tasbeehView.style.display = 'none';
                adhkarView.style.display = 'none';
                navPrayerBtn.classList.remove('active');
                navTasbeehBtn.classList.remove('active');
                navAdhkarBtn.classList.remove('active');

                if (viewName === 'prayer') {
                    prayerTrackerView.style.display = 'block';
                    navPrayerBtn.classList.add('active');
                } else if (viewName === 'tasbeeh') {
                    tasbeehView.style.display = 'block';
                    navTasbeehBtn.classList.add('active');
                } else if (viewName === 'adhkar') {
                    adhkarView.style.display = 'block';
                    navAdhkarBtn.classList.add('active');
                }
            }

            // --- Theme and Language ---
            function setupTheme() {
                document.body.classList.toggle('dark-mode', localStorage.getItem('theme') === 'dark');
            }

            function toggleTheme() {
                if (document.body.classList.contains('transition-active')) return;
                const root = document.documentElement;
                const isDarkMode = document.body.classList.contains('dark-mode');
                const rect = themeSwitcher.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                root.style.setProperty('--clip-x', `${x}px`);
                root.style.setProperty('--clip-y', `${y}px`);
                root.style.setProperty('--transition-bg', isDarkMode ? 'var(--background-color-light)' : 'var(--background-color-dark)');
                document.body.classList.add('transition-active');
                setTimeout(() => {
                    document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
                }, 300);
                setTimeout(() => document.body.classList.remove('transition-active'), 600);
            }
            
            function toggleLanguage() {
                currentLang = currentLang === 'ar' ? 'en' : 'ar';
                setLanguage(currentLang);
            }
            
            function setLanguage(lang, isInitial = false) {
                currentLang = lang;
                localStorage.setItem('language', lang);
                document.documentElement.lang = lang;
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

                document.querySelectorAll('[data-translate-key]').forEach(el => {
                    const key = el.dataset.translateKey;
                    const newText = translations[key]?.[lang];
                    if (newText) {
                        const target = el.tagName === 'INPUT' ? 'placeholder' : 'textContent';
                        if (isInitial) {
                            el[target] = newText;
                        } else {
                            if (target === 'textContent') applyScrambleAnimation(el, newText);
                            else el[target] = newText;
                        }
                    }
                });

                renderWeek();
                renderHistoricalStats();
                populateDhikrSelect();
                renderTasbeehStats();
                renderAdhkarWeek();
                if(currentAdhkarType) { showAdhkarList(currentAdhkarType); }
            }
            
            function applyScrambleAnimation(element, newText) {
                const chars = '!<>-_\\/[]{}â€”=+*^?#________';
                let frame = 0;
                let interval = setInterval(() => {
                    let scrambledText = '';
                    for (let i = 0; i < newText.length; i++) {
                        if (i < frame / 2) {
                            scrambledText += newText[i];
                        } else {
                            scrambledText += chars[Math.floor(Math.random() * chars.length)];
                        }
                    }
                    element.textContent = scrambledText;
                    if (frame >= newText.length * 2) {
                        clearInterval(interval);
                        element.textContent = newText;
                    }
                    frame++;
                }, 30);
            }

            // ===================================
            // --- PRAYER TRACKER LOGIC ---
            // ===================================
           function getStartOfWeek(offset) {
    const today = new Date(anchorDate);

    // Ù„Ø£Ù† ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø¹Ù†Ø¯Ùƒ ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø®Ù…ÙŠØ³
    const dayIndex = (today.getDay() + 3) % 7; 

    const start = new Date(today);
    start.setDate(today.getDate() - dayIndex + (offset * 7));
    start.setHours(0, 0, 0, 0);

    return start;
}

            
            function changeWeek(offset) {
                currentWeekOffset += offset;
                renderWeek();
            }

            function goToToday() {
                currentWeekOffset = 0;
                renderWeek();
            }

            function renderWeek() {
                if(!weekContainer) return;
                weekContainer.innerHTML = '';
                const today = new Date(anchorDate);
                const startOfWeek = getStartOfWeek(currentWeekOffset);
                updateWeekTitle(startOfWeek);
                
                const prevIcon = currentLang === 'ar' ? 'fa-chevron-right' : 'fa-chevron-left';
                const nextIcon = currentLang === 'ar' ? 'fa-chevron-left' : 'fa-chevron-right';
                prevWeekBtn.innerHTML = `<i class="fas ${prevIcon}"></i>`;
                nextWeekBtn.innerHTML = `<i class="fas ${nextIcon}"></i>`;
                
prevWeekBtn.disabled = false;

                for (let i = 0; i < 7; i++) {
                    const currentDate = new Date(startOfWeek);
                    currentDate.setDate(startOfWeek.getDate() + i);
                    const dateString = formatDate(currentDate);
                    const dayData = prayerData[dateString] || {};
                    const isToday = isSameDay(currentDate, today);
                    const isPast = currentDate < today;
                    const isFuture = currentDate > today;
                    const dayPrayers = getPrayersForDay(currentDate);
                    const isDayCompleted = Object.keys(dayPrayers).every(pKey => dayData[pKey]);
                    const isMissed = isPast && !isDayCompleted;
                    const dayCard = document.createElement('div');
                    dayCard.className = `day-card ${isToday ? 'today' : ''} ${isPast ? 'past' : ''} ${isFuture ? 'future' : ''} ${isMissed ? 'missed' : ''} ${isDayCompleted ? 'completed' : ''}`;
                    let prayerHTML = '<ul class="prayer-list">';
                    Object.entries(dayPrayers).forEach(([key, name]) => {
                        const prayerStatus = dayData[key];
                        const statusClass = prayerStatus ? `completed-${prayerStatus}` : '';
                        const iconClass = prayerStatus ? 'fa-check-circle' : 'fa-circle';
                        prayerHTML += `<li class="prayer-item ${statusClass}" data-date="${dateString}" data-prayer="${key}">
                            <span>${name}</span>
                            <i class="fas ${iconClass}"></i>
                        </li>`;
                    });
                    prayerHTML += '</ul>';
                    dayCard.innerHTML = `<div class="day-header"><div class="day-name">${daysOfWeek[currentLang][i]}</div><div class="date">${formatDateDisplay(currentDate)}</div></div>${prayerHTML}`;
                    weekContainer.appendChild(dayCard);
                }
                document.querySelectorAll('.prayer-item').forEach(item => {
                    if (!item.closest('.day-card.future')) {
                        item.addEventListener('click', handlePrayerClick);
                    }
                });
                updateStats();
            }
            
            function getPrayersForDay(date) {
                const isFriday = date.getDay() === 5; // Friday
                const dayPrayers = {};
                const currentLangPrayers = prayers[currentLang];
                prayerKeys.forEach(key => {
                    const prayerKey = (key === 'dhuhr' && isFriday) ? 'jumua' : key;
                    dayPrayers[prayerKey] = currentLangPrayers[prayerKey];
                });
                return dayPrayers;
            }
            
            function updateWeekTitle(startDate) {
                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + 6);
                let title;
                if (currentWeekOffset === 0) title = translations.week_current[currentLang];
                else if (currentWeekOffset > 0) title = translations.week_after[currentLang].replace('{count}', currentWeekOffset);
                else title = translations.week_ago[currentLang].replace('{count}', Math.abs(currentWeekOffset));
                
                weekTitle.textContent = `${title} (${formatDateDisplay(startDate)} - ${formatDateDisplay(endDate)})`;
            }

            function handlePrayerClick(e) {
                const item = e.currentTarget;
                const dateString = item.dataset.date;
                const prayerKey = item.dataset.prayer;
                const currentStatus = prayerData[dateString]?.[prayerKey];
                if (currentStatus) {
                    delete prayerData[dateString][prayerKey];
                    if (Object.keys(prayerData[dateString]).length === 0) delete prayerData[dateString];
                    showNotification(translations.notification_prayerCanceled[currentLang]);
                } else {
                    prayerToUpdate = { dateString, prayerKey };
                    onTimeModal.classList.add('active');
                    return;
                }
                localStorage.setItem('prayerData', JSON.stringify(prayerData));
                renderWeek();
                renderHistoricalStats();
            }
            
            function handlePrayerRecording(status) {
                if (!prayerToUpdate) return;
                const { dateString, prayerKey } = prayerToUpdate;
                if (!prayerData[dateString]) prayerData[dateString] = {};
                prayerData[dateString][prayerKey] = status;
                onTimeModal.classList.remove('active');
                localStorage.setItem('prayerData', JSON.stringify(prayerData));
                const statusText = translations[`status_${status}`][currentLang];
                showNotification(translations.notification_prayerRecorded[currentLang].replace('{status}', statusText));
                renderWeek();
                renderHistoricalStats();
                prayerToUpdate = null;
            }

            function updateStats() {
                const today = new Date(anchorDate);
                const startOfWeek = getStartOfWeek(currentWeekOffset);
                let completedDays = 0, onTimeCount = 0, lateCount = 0, totalPossiblePrayers = 0;

                for (let i = 0; i < 7; i++) {
                    const currentDate = new Date(startOfWeek);
                    currentDate.setDate(startOfWeek.getDate() + i);
                    const dateString = formatDate(currentDate);
                    const dayPrayers = getPrayersForDay(currentDate);
                    const dayPrayerKeys = Object.keys(dayPrayers);

                    if (prayerData[dateString]) {
                        Object.values(prayerData[dateString]).forEach(status => {
                            if (status === 'on_time') onTimeCount++;
                            else if (status === 'late') lateCount++;
                        });
                    }
                    
                    if (currentDate <= today) {
                        totalPossiblePrayers += dayPrayerKeys.length;
                        if (dayPrayerKeys.length > 0 && dayPrayerKeys.every(pKey => prayerData[dateString]?.[pKey])) {
                            completedDays++;
                        }
                    }
                }
                
                completedDaysEl.textContent = completedDays;
                onTimePrayersEl.textContent = onTimeCount;
                latePrayersEl.textContent = lateCount;

                const onTimePercentage = totalPossiblePrayers > 0 ? Math.round((onTimeCount / totalPossiblePrayers) * 100) : 0;
                const latePercentage = totalPossiblePrayers > 0 ? Math.round((lateCount / totalPossiblePrayers) * 100) : 0;
                
                onTimeProgressBar.style.width = `${onTimePercentage}%`;
                onTimePercentageEl.textContent = `${onTimePercentage}%`;
                lateProgressBar.style.width = `${latePercentage}%`;
                latePercentageEl.textContent = `${latePercentage}%`;
            }
            
            function resetWeekLogic() {
                const startOfWeek = getStartOfWeek(currentWeekOffset);
                for (let i = 0; i < 7; i++) {
                    const d = new Date(startOfWeek);
                    d.setDate(d.getDate() + i);
                    delete prayerData[formatDate(d)];
                }
                localStorage.setItem('prayerData', JSON.stringify(prayerData));
                renderWeek();
                renderHistoricalStats();
                showNotification(translations.notification_weekReset[currentLang]);
            }

            function markAllPastAsCompletedLogic() {
                const today = new Date(anchorDate);
                const startOfWeek = getStartOfWeek(currentWeekOffset);
                for (let i = 0; i < 7; i++) {
                    const d = new Date(startOfWeek);
                    d.setDate(d.getDate() + i);
                    if (d <= today) {
                        const dateString = formatDate(d);
                        if(!prayerData[dateString]) prayerData[dateString] = {};
                        const dayPrayers = getPrayersForDay(d);
                        Object.keys(dayPrayers).forEach(pKey => {
                            if (!prayerData[dateString][pKey]) {
                                prayerData[dateString][pKey] = 'on_time';
                            }
                        });
                    }
                }
                localStorage.setItem('prayerData', JSON.stringify(prayerData));
                renderWeek();
                renderHistoricalStats();
                showNotification(translations.notification_pastCompleted[currentLang]);
            }
            
      function renderHistoricalStats() {
            if(!historicalContainer) return;
            
            const weeks = {};
            // Ù‡Ø°Ø§ Ù‡Ùˆ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚. Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„Ù‡ Ø³ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„Ù‡Ø§
            const genesisDate = new Date('2025-10-15T00:00:00');

            Object.keys(prayerData).forEach(dateStr => {
                const date = new Date(dateStr);
                
                // --- Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ ---
                // ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„ØµÙ„Ø§Ø© Ù„ÙŠØ³ Ø£Ù‚Ø¯Ù… Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                if (date < genesisDate) return;
                
                if (date > anchorDate) return;
                const d = new Date(date);
                d.setDate(d.getDate() - (d.getDay() + 4) % 7);
                const weekKey = formatDate(d);
                if (!weeks[weekKey]) {
                    weeks[weekKey] = { on_time: 0, late: 0, start: d };
                }
                 Object.values(prayerData[dateStr]).forEach(status => {
                    if (status === 'on_time') weeks[weekKey].on_time++;
                    if (status === 'late') weeks[weekKey].late++;
                });
            });

            historicalContainer.innerHTML = '';
            const sortedWeeks = Object.keys(weeks).sort((a,b) => new Date(b) - new Date(a));
            
            let weeksDisplayed = 0;

            sortedWeeks.forEach(weekKey => {
                const weekData = weeks[weekKey];
                const endDate = new Date(weekData.start);
                endDate.setDate(endDate.getDate() + 6);

                if (endDate < anchorDate) {
                    if (weekData.on_time > 0 || weekData.late > 0) {
                        weeksDisplayed++;
                        const card = document.createElement('div');
                        card.className = 'history-card';
                        card.innerHTML = `<div class="history-card-title">${translations.week_title_prefix[currentLang]} ${formatDateDisplay(weekData.start)} - ${formatDateDisplay(endDate)}</div>
                                              <div class="history-card-stats">
                                                <span class="on-time-stat">${weekData.on_time} ${translations.status_on_time[currentLang]}</span> | <span class="late-stat">${weekData.late} ${translations.status_late[currentLang]}</span>
                                              </div>`;
                        historicalContainer.appendChild(card);
                    }
                }
            });
            
            if (weeksDisplayed === 0) {
                historicalContainer.innerHTML = `<p style="color: var(--light-text); text-align: center;" data-translate-key="noHistory">${translations.noHistory[currentLang]}</p>`;
            }
        }
            // ===================================
            // --- TASBEEH LOGIC ---
            // ===================================
            function initTasbeeh() {
                populateDhikrSelect();
                handleDhikrChange();
                renderTasbeehStats();
            }

            function populateDhikrSelect() {
                const selectedValue = dhikrSelect.value;
                dhikrSelect.innerHTML = '';
                for (const key in tasbeehOptions) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = tasbeehOptions[key][currentLang];
                    dhikrSelect.appendChild(option);
                }
                dhikrSelect.value = selectedValue && dhikrSelect.querySelector(`option[value="${selectedValue}"]`) ? selectedValue : 'subhanallah';
            }

            function handleDhikrChange() {
                const selected = dhikrSelect.value;
                customDhikrInput.style.display = selected === 'custom' ? 'block' : 'none';
                currentTasbeehCount = 0;
                updateTasbeehDisplay();
            }

            function handleTasbeehClick() {
                currentTasbeehCount++;
                const selectedKey = dhikrSelect.value;
                let dataKey;

                if (selectedKey === 'custom') {
                    dataKey = customDhikrInput.value.trim();
                    if (!dataKey) {
                        currentTasbeehCount--;
                        return;
                    }
                } else {
                    dataKey = selectedKey;
                }

                tasbeehData[dataKey] = (tasbeehData[dataKey] || 0) + 1;
                localStorage.setItem('tasbeehData', JSON.stringify(tasbeehData));
                
                updateTasbeehDisplay();
                renderTasbeehStats();
            }

            function handleTasbeehReset(event) {
                event.stopPropagation();
                currentTasbeehCount = 0;
                updateTasbeehDisplay();
                showNotification(translations.tasbeehCountReset[currentLang]);
            }

            function resetAllTasbeehLogic() {
                tasbeehData = {};
                localStorage.setItem('tasbeehData', JSON.stringify(tasbeehData));
                renderTasbeehStats();
                showNotification(translations.notification_tasbeehResetAll[currentLang]);
            }

            function updateTasbeehDisplay() {
                tasbeehCounterDisplay.textContent = currentTasbeehCount;
                const selectedKey = dhikrSelect.value;
                if (selectedKey === 'custom') {
                    currentDhikrDisplay.textContent = customDhikrInput.value.trim() || '...';
                } else {
                    currentDhikrDisplay.textContent = tasbeehOptions[selectedKey][currentLang];
                }
            }
            
            function handleDeleteSingleDhikr(event) {
                const deleteBtn = event.target.closest('.delete-dhikr-btn');
                if (!deleteBtn) return;

                const dhikrKey = deleteBtn.dataset.dhikrKey;
                if (dhikrKey && tasbeehData.hasOwnProperty(dhikrKey)) {
                    const dhikrLabel = tasbeehOptions[dhikrKey] ? tasbeehOptions[dhikrKey][currentLang] : dhikrKey;
                    const message = translations.confirmDeleteDhikrMsg[currentLang].replace('{dhikr}', dhikrLabel);

                    const deleteAction = () => {
                        delete tasbeehData[dhikrKey];
                        localStorage.setItem('tasbeehData', JSON.stringify(tasbeehData));
                        renderTasbeehStats();
                        showNotification(translations.notification_dhikrDeleted[currentLang]);
                    };
                    showConfirmation(message, deleteAction);
                }
            }
            
            function renderTasbeehStats() {
                tasbeehStatsContainer.innerHTML = '';
                if (Object.keys(tasbeehData).length === 0) {
                     tasbeehStatsContainer.innerHTML = `<p style="color: var(--light-text); text-align: center; grid-column: 1 / -1;">${translations.noHistory[currentLang]}</p>`
                     return;
                }
                
                for (const key in tasbeehData) {
                    const statItem = document.createElement('div');
                    statItem.className = 'stat-item';
                    
                    const label = tasbeehOptions[key] ? tasbeehOptions[key][currentLang] : key;
                    const value = tasbeehData[key];
                    const escapedKey = key.replace(/'/g, "\\'").replace(/"/g, '&quot;');

                    statItem.innerHTML = `
                        <button class="delete-dhikr-btn" data-dhikr-key="${escapedKey}" title="${translations.deleteDhikrTitle[currentLang]}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        <div class="stat-value on-time-stat">${value}</div>
                        <div class="stat-label">${label}</div>
                    `;
                    tasbeehStatsContainer.appendChild(statItem);
                }
            }
            
            // ===================================
            // --- ADHKAR LOGIC ---
            // ===================================
            function initAdhkar() {
                goToAdhkarToday();
                renderHistoricalAdhkarStats();
            }

            function showAdhkarList(type) {
                currentAdhkarType = type;
                adhkarListContainer.style.display = 'block';
                currentAdhkarTitle.textContent = translations[type === 'sabah' ? 'adhkarSabah' : 'adhkarMasaa'][currentLang];
                adhkarContent[type].forEach(dhikr => dhikr.current = 0);
                renderAdhkarList();
            }

            function renderAdhkarList() {
                if (!currentAdhkarType) return;
                adhkarItemsWrapper.innerHTML = '';
                adhkarContent[currentAdhkarType].forEach((dhikr, index) => {
                    const isCompleted = dhikr.current >= dhikr.count;
                    const item = document.createElement('div');
                    item.className = `dhikr-item ${isCompleted ? 'completed' : ''}`;
                    item.dataset.index = index;
                    item.innerHTML = `
                        <div class="dhikr-content">${dhikr.text}</div>
                        <div class="dhikr-counter">
                            <span>${translations.dhikrCount[currentLang]}: ${dhikr.count}</span>
                            <span>${dhikr.current}</span>
                        </div>
                    `;
                    adhkarItemsWrapper.appendChild(item);
                });
            }

            function handleDhikrItemClick(e) {
                const item = e.target.closest('.dhikr-item');
                if (!item) return;
                const index = parseInt(item.dataset.index, 10);
                const dhikr = adhkarContent[currentAdhkarType][index];
                if (dhikr.current < dhikr.count) {
                    dhikr.current++;
                    renderAdhkarList();
                }
            }

            function handleCompleteAllAdhkar() {
                if (!currentAdhkarType) return;
                adhkarContent[currentAdhkarType].forEach(dhikr => dhikr.current = dhikr.count);
                renderAdhkarList();
            }

            function changeAdhkarWeek(offset) {
                currentAdhkarWeekOffset += offset;
                renderAdhkarWeek();
            }

            function goToAdhkarToday() {
                currentAdhkarWeekOffset = 0;
                renderAdhkarWeek();
            }

            function renderAdhkarWeek() {
                if (!adhkarWeekContainer) return;
                adhkarWeekContainer.innerHTML = '';
                const today = new Date(anchorDate);
                const startOfWeek = getStartOfWeek(currentAdhkarWeekOffset);
                updateAdhkarWeekTitle(startOfWeek);
                
                const prevIcon = currentLang === 'ar' ? 'fa-chevron-right' : 'fa-chevron-left';
                const nextIcon = currentLang === 'ar' ? 'fa-chevron-left' : 'fa-chevron-right';
                adhkarPrevWeekBtn.innerHTML = `<i class="fas ${prevIcon}"></i>`;
                adhkarNextWeekBtn.innerHTML = `<i class="fas ${nextIcon}"></i>`;
adhkarPrevWeekBtn.disabled = false;

                for (let i = 0; i < 7; i++) {
                    const currentDate = new Date(startOfWeek);
                    currentDate.setDate(startOfWeek.getDate() + i);
                    const dateString = formatDate(currentDate);
                    const dayProgress = adhkarProgress[dateString] || {};
                    const isToday = isSameDay(currentDate, today);
                    const isFuture = currentDate > today;

                    const dayCard = document.createElement('div');
                    dayCard.className = `day-card adhkar-day-card ${isToday ? 'today' : ''} ${isFuture ? 'future' : ''}`;
                    dayCard.dataset.date = dateString;
                    
                    const sabahIcon = dayProgress.sabah ? 'fa-check-circle' : 'fa-circle';
                    const masaaIcon = dayProgress.masaa ? 'fa-check-circle' : 'fa-circle';

                    dayCard.innerHTML = `
                        <div class="day-header">
                            <div class="day-name">${daysOfWeek[currentLang][i]}</div>
                            <div class="date">${formatDateDisplay(currentDate)}</div>
                        </div>
                        <div class="adhkar-status">
                            <div class="adhkar-status-item ${dayProgress.sabah ? 'completed' : ''}" data-type="sabah">
                                <i class="fas ${sabahIcon}"></i>
                                <span>${translations.adhkarSabah[currentLang]}</span>
                            </div>
                            <div class="adhkar-status-item ${dayProgress.masaa ? 'completed' : ''}" data-type="masaa">
                                <i class="fas ${masaaIcon}"></i>
                                <span>${translations.adhkarMasaa[currentLang]}</span>
                            </div>
                        </div>
                    `;
                    adhkarWeekContainer.appendChild(dayCard);
                }
                updateAdhkarStats();
                renderHistoricalAdhkarStats();
            }

            function updateAdhkarWeekTitle(startDate) {
                 const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + 6);
                let title;
                if (currentAdhkarWeekOffset === 0) title = translations.week_current[currentLang];
                else if (currentAdhkarWeekOffset > 0) title = translations.week_after[currentLang].replace('{count}', currentAdhkarWeekOffset);
                else title = translations.week_ago[currentLang].replace('{count}', Math.abs(currentAdhkarWeekOffset));
                
                adhkarWeekTitle.textContent = `${title} (${formatDateDisplay(startDate)} - ${formatDateDisplay(endDate)})`;
            }

       function handleAdhkarDayClick(e) {
    const item = e.target.closest('.adhkar-status-item');
    const dayCard = e.target.closest('.day-card');
    if (!item || !dayCard) return;

    const dateString = dayCard.dataset.date;

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø´ÙƒÙ„ Ù…Ø­Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø§ÙƒÙ„ UTC
    const [year, month, day] = dateString.split('-').map(Number);
    const clickedDate = new Date(year, month - 1, day);
    clickedDate.setHours(0, 0, 0, 0);

    // ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ø­Ø³Ø¨ Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙˆÙ„ÙŠØ³ UTC)
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    // ğŸ”’ Ù…Ù†Ø¹ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ ÙÙ‚Ø· (Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…Ø§Ø¶ÙŠ)
    if (clickedDate > today) {
        return;
    }

    const type = item.dataset.type;

    if (!adhkarProgress[dateString]) {
        adhkarProgress[dateString] = {};
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© (ØªØ¹Ù„ÙŠÙ… / Ø¥Ù„ØºØ§Ø¡)
    adhkarProgress[dateString][type] = !adhkarProgress[dateString][type];

    localStorage.setItem('adhkarProgress', JSON.stringify(adhkarProgress));

    const key = adhkarProgress[dateString][type]
        ? `adhkarMarked${type.charAt(0).toUpperCase() + type.slice(1)}`
        : `adhkarUnmarked${type.charAt(0).toUpperCase() + type.slice(1)}`;

    showNotification(translations[key][currentLang]);

    renderAdhkarWeek();
}

            function updateAdhkarStats() {
                const today = new Date(anchorDate);
                const startOfWeek = getStartOfWeek(currentAdhkarWeekOffset);
                let sabahCount = 0, masaaCount = 0, missedSabah = 0, missedMasaa = 0, totalPossibleDays = 0;

                for (let i = 0; i < 7; i++) {
                    const d = new Date(startOfWeek);
                    d.setDate(d.getDate() + i);
                    
                    if (d > today) continue;
                    
                    totalPossibleDays++;
                    const dateString = formatDate(d);
                    const dayProgress = adhkarProgress[dateString] || {};

                    if (dayProgress.sabah) sabahCount++;
                    else missedSabah++;

                    if (dayProgress.masaa) masaaCount++;
                    else missedMasaa++;
                }
                
                adhkarSabahValueEl.textContent = sabahCount;
                adhkarMasaaValueEl.textContent = masaaCount;
                adhkarSabahMissedValueEl.textContent = missedSabah;
                adhkarMasaaMissedValueEl.textContent = missedMasaa;

                const sabahPercentage = totalPossibleDays > 0 ? Math.round((sabahCount / totalPossibleDays) * 100) : 0;
                const masaaPercentage = totalPossibleDays > 0 ? Math.round((masaaCount / totalPossibleDays) * 100) : 0;
                
                sabahProgressBar.style.width = `${sabahPercentage}%`;
                sabahPercentageEl.textContent = `${sabahPercentage}%`;
                masaaProgressBar.style.width = `${masaaPercentage}%`;
                masaaPercentageEl.textContent = `${masaaPercentage}%`;
            }

            function resetAdhkarWeekLogic() {
                const startOfWeek = getStartOfWeek(currentAdhkarWeekOffset);
                 for (let i = 0; i < 7; i++) {
                    const d = new Date(startOfWeek);
                    d.setDate(d.getDate() + i);
                    delete adhkarProgress[formatDate(d)];
                }
                localStorage.setItem('adhkarProgress', JSON.stringify(adhkarProgress));
                renderAdhkarWeek();
                showNotification(translations.adhkarWeekReset[currentLang]);
            }
            
            function markAllPastAdhkarAsCompletedLogic() {
                 const today = new Date(anchorDate);
                const startOfWeek = getStartOfWeek(currentAdhkarWeekOffset);
                for (let i = 0; i < 7; i++) {
                    const d = new Date(startOfWeek);
                    d.setDate(d.getDate() + i);
                    if (d <= today) {
                        const dateString = formatDate(d);
                        if(!adhkarProgress[dateString]) adhkarProgress[dateString] = {};
                        adhkarProgress[dateString].sabah = true;
                        adhkarProgress[dateString].masaa = true;
                    }
                }
                localStorage.setItem('adhkarProgress', JSON.stringify(adhkarProgress));
                renderAdhkarWeek();
                showNotification(translations.adhkarPastCompleted[currentLang]);
            }
function renderHistoricalAdhkarStats() {
            if (!historicalAdhkarContainer) return;

            const weeks = {};
            // Ù‡Ø°Ø§ Ù‡Ùˆ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚. Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„Ù‡ Ø³ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„Ù‡Ø§
            const genesisDate = new Date('2025-10-15T00:00:00');

            Object.keys(adhkarProgress).forEach(dateStr => {
                const date = new Date(dateStr);
                
                // --- Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ ---
                // ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø°ÙƒØ± Ù„ÙŠØ³ Ø£Ù‚Ø¯Ù… Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                if (date < genesisDate) return; 

                if (date > anchorDate) return;

                const d = new Date(date);
                d.setDate(d.getDate() - (d.getDay() + 4) % 7);
                const weekKey = formatDate(d);

                if (!weeks[weekKey]) {
                    weeks[weekKey] = { sabah: 0, masaa: 0, start: d };
                }
                if(adhkarProgress[dateStr].sabah) weeks[weekKey].sabah++;
                if(adhkarProgress[dateStr].masaa) weeks[weekKey].masaa++;
            });

            historicalAdhkarContainer.innerHTML = '';
            const sortedWeeks = Object.keys(weeks).sort((a, b) => new Date(b) - new Date(a));
            
            let weeksDisplayed = 0;

            sortedWeeks.forEach(weekKey => {
                const weekData = weeks[weekKey];
                const endDate = new Date(weekData.start);
                endDate.setDate(endDate.getDate() + 6);

                if (endDate < anchorDate) {
                    if (weekData.sabah > 0 || weekData.masaa > 0) {
                        weeksDisplayed++;
                        const card = document.createElement('div');
                        card.className = 'history-card';
                        card.innerHTML = `
                                <div class="history-card-title">${translations.week_title_prefix[currentLang]} ${formatDateDisplay(weekData.start)} - ${formatDateDisplay(endDate)}</div>
                                <div class="history-card-stats">
                                    <span class="on-time-stat">${weekData.sabah} ${translations.adhkarSabah[currentLang]}</span> | 
                                    <span class="late-stat" style="color: var(--accent-color)">${weekData.masaa} ${translations.adhkarMasaa[currentLang]}</span>
                                </div>`;
                        historicalAdhkarContainer.appendChild(card);
                    }
                }
            });
            
            if (weeksDisplayed === 0) {
                historicalAdhkarContainer.innerHTML = `<p style="color: var(--light-text); text-align: center;" data-translate-key="noHistory">${translations.noHistory[currentLang]}</p>`;
            }
            }
            // --- Modals and Actions ---
            function showConfirmation(message, action) {
                confirmationMessage.textContent = message;
                onConfirmAction = action;
                confirmationModal.classList.add('active');
            }

            function handleConfirmYes() {
                if (typeof onConfirmAction === 'function') onConfirmAction();
                confirmationModal.classList.remove('active');
            }

            // --- UTILS ---
            function showNotification(message) {
                notification.innerHTML = `<i class="fas fa-check-circle"></i> <div>${message}</div>`;
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 3000);
            }

            function handleScroll() {
                backToTopBtn.classList.toggle('show', window.scrollY > 300);
            }

            function scrollToTop() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}
            function formatDateDisplay(date) { 
                const locale = currentLang === 'ar' ? 'ar-EG' : 'en-US';
                return date.toLocaleDateString(locale, { day: 'numeric', month: 'long' }); 
            }
            function isSameDay(d1, d2) { return d1.toDateString() === d2.toDateString(); }

            initApp();
        });
    </script>
</body>
</html>